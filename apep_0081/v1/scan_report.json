{
  "paper_id": "apep_0081",
  "scan_date": "2026-02-06T12:42:59.617652+00:00",
  "scan_version": "2.0.0",
  "model": "openai/gpt-5.2",
  "overall_verdict": "SUSPICIOUS",
  "files_scanned": 24,
  "flags": [
    {
      "category": "METHODOLOGY_MISMATCH",
      "severity": "HIGH",
      "file": "09_border_figures.R",
      "lines": [
        20,
        33
      ],
      "evidence": "The manuscript explicitly states that dist_to_border_km is computed using a fixed 2018\u20132019 legal/illegal classification and is set to NA outside 2018\u20132019; therefore border-distance analyses should effectively be limited to 2018\u20132019. This script labels the border analysis as \u201c2016\u20132019\u201d and filters year >= 2016, which is inconsistent with the manuscript\u2019s stated validity window and figure captions in the paper (Figures 24\u201325 are described as border-distance patterns for the stable-policy period). Even if dist_to_border_km is NA outside 2018\u20132019, the \u201c2016\u20132019\u201d labeling is misleading and should be aligned to 2018\u20132019 (or the border-distance construction must be extended appropriately).: border_data <- fars %>%\n  filter(!is.na(dist_to_border_km), dist_to_border_km < 200) %>%\n  filter(year >= 2016)  # Post-legalization period",
      "confidence": 0.85
    },
    {
      "category": "METHODOLOGY_MISMATCH",
      "severity": "HIGH",
      "file": "09_border_figures.R",
      "lines": [
        70,
        98
      ],
      "evidence": "The manuscript defines THC identification as text-based drug name matching that is only reliable from 2018 onward, and interprets the denominator as \u201ccrashes with any drug record.\u201d This script uses thc_positive from the analysis RDS without enforcing year >= 2018 (it only uses year >= 2016 via border_data) and does not condition on \u201ccrashes with any drug record\u201d explicitly\u2014only on non-missing thc_positive. This can diverge from the paper\u2019s intended definition if thc_positive is defined differently across years or if non-missing thc_positive does not strictly equal \u201chas any drug record.\u201d: thc_by_dist <- border_data %>%\n  filter(!is.na(thc_positive), !is.na(dist_bin)) %>%\n  group_by(dist_bin, side) %>%\n  summarise(\n    tested = n(),\n    thc_pos = sum(thc_positive),\n    pct_thc = 100 * thc_pos / tested,\n    se = sqrt(pct_thc * (100 - pct_thc) / tested),\n    .groups = \"drop\"\n  )",
      "confidence": 0.78
    },
    {
      "category": "METHODOLOGY_MISMATCH",
      "severity": "HIGH",
      "file": "01_fetch_fars.R",
      "lines": [
        170,
        186
      ],
      "evidence": "The manuscript states THC-positive is identified via text pattern matching in the drug result name field (drugresname) and that this is only reliable from 2018 onward. In contrast, this code defines thc_positive using numeric drug codes (drugspec 600\u2013695) and drugres==1. That is a different measurement approach than described in the paper, and it would typically allow extending THC/cannabinoid identification to earlier years (subject to coding changes), contradicting the manuscript\u2019s claim that THC identification is only reliable from 2018 onward. This discrepancy affects the interpretation of all THC rates/figures unless the later pipeline overwrites thc_positive with a text-match-based measure (not shown in the provided files).: # THC drug codes in FARS (codes 600-695 are cannabinoids)\nTHC_CODES <- 600:695\n\n# Summarize drug involvement from drugs file\nif (nrow(fars_drugs) > 0) {\n  drug_summary <- fars_drugs_west %>%\n    group_by(st_case, state, year) %>%\n    summarise(\n      any_drug_test = TRUE,\n      thc_positive = any(drugspec %in% THC_CODES & drugres == 1, na.rm = TRUE),\n      any_drug_positive = any(drugres == 1, na.rm = TRUE),\n      n_drugs_positive = sum(drugres == 1, na.rm = TRUE),\n      .groups = \"drop\"\n    )\n}",
      "confidence": 0.9
    },
    {
      "category": "METHODOLOGY_MISMATCH",
      "severity": "MEDIUM",
      "file": "09_border_figures.R",
      "lines": [
        108,
        165
      ],
      "evidence": "The manuscript states that \u201cdata limitations \u2026 preclude a true event study design\u201d and the appendix explicitly notes an event study figure is omitted due to THC data only being available 2018+. However, this script generates an event-study figure and state-specific event studies using rel_time_rec and thc_positive. Unless the manuscript is updated to describe these as exploratory/illustrative (and to clarify THC availability/measurement over time), this is a code\u2013paper inconsistency that can mislead readers about what was actually feasible with the data as described.: # =============================================================================\n# Figure 26: Event Study - THC Rates Around Legalization\n# =============================================================================\n...\nevent_data <- fars %>%\n  filter(ever_rec_legal, !is.na(rel_time_rec), !is.na(thc_positive)) %>%\n  mutate(\n    event_year = floor(rel_time_rec / 12)\n  ) %>%\n  filter(event_year >= -5, event_year <= 8)",
      "confidence": 0.86
    },
    {
      "category": "SUSPICIOUS_TRANSFORMS",
      "severity": "LOW",
      "file": "09_border_figures.R",
      "lines": [
        78,
        86
      ],
      "evidence": "The standard error formula is the binomial SE but implemented on a 0\u2013100 scale. While algebraically convertible, this is easy to misuse; the conventional form is sqrt(p*(1-p)/n) with p in [0,1], then multiply by 100 if plotting percentages. As written, it yields the correct magnitude only because it implicitly treats \u201cpct_thc\u201d as \u2018percent points\u2019 and \u201c100-pct_thc\u201d as the complement percent; this is acceptable for plotting but fragile and can produce confusion or errors if later reused for inference.: pct_thc = 100 * thc_pos / tested,\nse = sqrt(pct_thc * (100 - pct_thc) / tested)",
      "confidence": 0.7
    },
    {
      "category": "DATA_PROVENANCE_MISSING",
      "severity": "MEDIUM",
      "file": "10_tables.R",
      "lines": [
        1,
        8
      ],
      "evidence": "Key inputs (fars_analysis_policy.rds and marijuana_policy.rds) are loaded as pre-built RDS objects, but the scripts that create them are referenced in the manuscript replication steps (e.g., 04_merge_policy.R) and are not included among the provided code files. Within the provided files, there is no auditable code showing how marijuana_policy.rds was sourced/constructed (Harvard Dataverse + manual verification per manuscript) nor how policy variables were merged into fars_analysis_policy.rds. This is not evidence of fabrication, but it is a provenance gap for critical treatment/policy timing variables and derived indicators such as rec_legal/ever_rec_legal/rel_time_rec.: fars <- readRDS(file.path(dir_data, \"fars_analysis_policy.rds\"))\nmarijuana_policy <- readRDS(file.path(dir_data_policy, \"marijuana_policy.rds\"))",
      "confidence": 0.75
    }
  ],
  "file_verdicts": [
    {
      "file": "09_border_figures.R",
      "verdict": "SUSPICIOUS"
    },
    {
      "file": "01_fetch_fars.R",
      "verdict": "SUSPICIOUS"
    },
    {
      "file": "10_tables.R",
      "verdict": "CLEAN"
    },
    {
      "file": "07_zoom_figures.R",
      "verdict": "CLEAN"
    },
    {
      "file": "clean_and_fix_data.R",
      "verdict": "CLEAN"
    },
    {
      "file": "00_packages.R",
      "verdict": "CLEAN"
    },
    {
      "file": "diagnose_thc_rates.R",
      "verdict": "CLEAN"
    },
    {
      "file": "fix_remaining_figures.R",
      "verdict": "CLEAN"
    },
    {
      "file": "05_build_analysis.R",
      "verdict": "CLEAN"
    },
    {
      "file": "regenerate_figures.R",
      "verdict": "CLEAN"
    },
    {
      "file": "regenerate_all_figures.R",
      "verdict": "CLEAN"
    },
    {
      "file": "fix_testing_rate.R",
      "verdict": "CLEAN"
    },
    {
      "file": "fix_substance_data.R",
      "verdict": "CLEAN"
    },
    {
      "file": "fix_polysubstance_figure.R",
      "verdict": "CLEAN"
    },
    {
      "file": "06_national_figures.R",
      "verdict": "CLEAN"
    },
    {
      "file": "fix_final_figures.R",
      "verdict": "CLEAN"
    },
    {
      "file": "08_substance_figures.R",
      "verdict": "CLEAN"
    },
    {
      "file": "04_merge_policy.R",
      "verdict": "CLEAN"
    },
    {
      "file": "fix_substance_figures.R",
      "verdict": "CLEAN"
    },
    {
      "file": "fix_all_figure_labels.R",
      "verdict": "CLEAN"
    },
    {
      "file": "fix_figure_labels.R",
      "verdict": "CLEAN"
    },
    {
      "file": "fix_all_figures.R",
      "verdict": "CLEAN"
    },
    {
      "file": "03_snap_crashes.py",
      "verdict": "CLEAN"
    },
    {
      "file": "02_fetch_osm.py",
      "verdict": "CLEAN"
    }
  ],
  "summary": {
    "verdict": "SUSPICIOUS",
    "counts": {
      "CRITICAL": 0,
      "HIGH": 3,
      "MEDIUM": 2,
      "LOW": 1
    },
    "one_liner": "method mismatch",
    "executive_summary": "The border-distance and border-comparison analyses are implemented inconsistently with the manuscript\u2019s stated design: `dist_to_border_km` is not restricted to a fixed 2018\u20132019 legal/illegal classification and is not set to `NA` outside 2018\u20132019 as described, so results can inadvertently mix years and policy regimes. The THC outcome is also coded differently than claimed: instead of limiting THC identification to 2018+ using text-based matching in `drugresname` and using \u201ccrashes with any drug record\u201d as the denominator, the scripts apply a different THC definition and denominator logic, which can change both who is counted as THC-positive and the rate estimates.",
    "top_issues": [
      {
        "category": "METHODOLOGY_MISMATCH",
        "severity": "HIGH",
        "short": "The manuscript explicitly states that dist_to_border_km i...",
        "file": "09_border_figures.R",
        "lines": [
          20,
          33
        ],
        "github_url": "/apep_0081/code/09_border_figures.R#L20-L33"
      },
      {
        "category": "METHODOLOGY_MISMATCH",
        "severity": "HIGH",
        "short": "The manuscript defines THC identification as text-based d...",
        "file": "09_border_figures.R",
        "lines": [
          70,
          98
        ],
        "github_url": "/apep_0081/code/09_border_figures.R#L70-L98"
      },
      {
        "category": "METHODOLOGY_MISMATCH",
        "severity": "HIGH",
        "short": "The manuscript states THC-positive is identified via text...",
        "file": "01_fetch_fars.R",
        "lines": [
          170,
          186
        ],
        "github_url": "/apep_0081/code/01_fetch_fars.R#L170-L186"
      }
    ],
    "full_report_url": "/tournament/corpus_scanner/scans/apep_0081_scan.json"
  },
  "error": null
}